/**
 * Copyright © 2024 Angular Primitives.
 * https://github.com/ng-primitives/ng-primitives
 *
 * This source code is licensed under the Apache 2.0 license found in the
 * LICENSE file in the root directory of this source tree.
 */
import { Directive, contentChild, signal } from '@angular/core';
import { NgControl } from '@angular/forms';
import { onChange } from 'ng-primitives/utils';
import { NgpFormFieldToken } from './form-field.token';
import * as i0 from "@angular/core";
export class NgpFormField {
    constructor() {
        /**
         * Store the form label.
         * @internal
         */
        this.labels = signal([]);
        /**
         * Store the form descriptions.
         * @internal
         */
        this.descriptions = signal([]);
        /**
         * Store the id of the associated form control.
         * @internal
         */
        this.formControl = signal(null);
        /**
         * Find any NgControl within the form field.
         * @internal
         */
        this.ngControl = contentChild(NgControl);
        /**
         * Store the validation error messages.
         * @internal
         */
        this.errors = signal([]);
        /**
         * Whether the control is pristine.
         * @internal
         */
        this.pristine = signal(null);
        /**
         * Whether the control is touched.
         * @internal
         */
        this.touched = signal(null);
        /**
         * Whether the control is dirty.
         * @internal
         */
        this.dirty = signal(null);
        /**
         * Whether the control is valid.
         */
        this.valid = signal(null);
        /**
         * Whether the control is invalid.
         * @internal
         */
        this.invalid = signal(null);
        /**
         * Whether the control is pending.
         * @internal
         */
        this.pending = signal(null);
        /**
         * Whether the control is disabled.
         * @internal
         */
        this.disabled = signal(null);
        // any time the ngControl changes, setup the subscriptions.
        onChange(this.ngControl, this.setupSubscriptions.bind(this));
    }
    ngOnDestroy() {
        this.subscription?.unsubscribe();
    }
    /**
     * Setup a listener for the form control status.
     * @param control
     */
    setupSubscriptions(control) {
        // Unsubscribe from the previous subscriptions.
        this.subscription?.unsubscribe();
        // set the initial values
        this.updateStatus();
        // Listen for changes to the form control.
        this.subscription = control?.valueChanges?.subscribe(this.updateStatus.bind(this));
    }
    updateStatus() {
        const control = this.ngControl();
        if (!control) {
            return;
        }
        this.pristine.set(control.pristine);
        this.touched.set(control.touched);
        this.dirty.set(control.dirty);
        this.valid.set(control.valid);
        this.invalid.set(control.invalid);
        this.pending.set(control.pending);
        this.disabled.set(control.disabled);
        this.errors.set(control?.errors ? Object.keys(control.errors) : []);
    }
    /**
     * Register the id of the associated form control.
     * @param id
     * @internal
     */
    setFormControl(id) {
        this.formControl.set(id);
    }
    /**
     * Register a label with the form field.
     * @param label
     * @internal
     */
    addLabel(label) {
        this.labels.update(labels => [...labels, label]);
    }
    /**
     * Register a description with the form field.
     * @param description
     * @internal
     */
    addDescription(description) {
        this.descriptions.update(descriptions => [...descriptions, description]);
    }
    /**
     * Remove the associated form control.
     * @internal
     */
    removeFormControl() {
        this.formControl.set(null);
    }
    /**
     * Remove a label from the form field.
     * @param label
     * @internal
     */
    removeLabel(label) {
        this.labels.update(labels => labels.filter(l => l !== label));
    }
    /**
     * Remove a description from the form field.
     * @param description
     * @internal
     */
    removeDescription(description) {
        this.descriptions.update(descriptions => descriptions.filter(d => d !== description));
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.2.13", ngImport: i0, type: NgpFormField, deps: [], target: i0.ɵɵFactoryTarget.Directive }); }
    static { this.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "17.2.0", version: "18.2.13", type: NgpFormField, isStandalone: true, selector: "[ngpFormField]", host: { properties: { "attr.data-invalid": "invalid() ? \"\" : null", "attr.data-valid": "valid() ? \"\" : null", "attr.data-touched": "touched() ? \"\" : null", "attr.data-pristine": "pristine() ? \"\" : null", "attr.data-dirty": "dirty() ? \"\" : null", "attr.data-pending": "pending() ? \"\" : null", "attr.data-disabled": "disabled() ? \"\" : null" } }, providers: [{ provide: NgpFormFieldToken, useExisting: NgpFormField }], queries: [{ propertyName: "ngControl", first: true, predicate: NgControl, descendants: true, isSignal: true }], exportAs: ["ngpFormField"], ngImport: i0 }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.2.13", ngImport: i0, type: NgpFormField, decorators: [{
            type: Directive,
            args: [{
                    standalone: true,
                    selector: '[ngpFormField]',
                    exportAs: 'ngpFormField',
                    providers: [{ provide: NgpFormFieldToken, useExisting: NgpFormField }],
                    host: {
                        '[attr.data-invalid]': 'invalid() ? "" : null',
                        '[attr.data-valid]': 'valid() ? "" : null',
                        '[attr.data-touched]': 'touched() ? "" : null',
                        '[attr.data-pristine]': 'pristine() ? "" : null',
                        '[attr.data-dirty]': 'dirty() ? "" : null',
                        '[attr.data-pending]': 'pending() ? "" : null',
                        '[attr.data-disabled]': 'disabled() ? "" : null',
                    },
                }]
        }], ctorParameters: () => [] });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9ybS1maWVsZC5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9wYWNrYWdlcy9uZy1wcmltaXRpdmVzL2Zvcm0tZmllbGQvc3JjL2Zvcm0tZmllbGQvZm9ybS1maWVsZC5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7OztHQU1HO0FBQ0gsT0FBTyxFQUFFLFNBQVMsRUFBYSxZQUFZLEVBQUUsTUFBTSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNFLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUMzQyxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFFL0MsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sb0JBQW9CLENBQUM7O0FBaUJ2RCxNQUFNLE9BQU8sWUFBWTtJQTZFdkI7UUE1RUE7OztXQUdHO1FBQ00sV0FBTSxHQUFHLE1BQU0sQ0FBVyxFQUFFLENBQUMsQ0FBQztRQUV2Qzs7O1dBR0c7UUFDTSxpQkFBWSxHQUFHLE1BQU0sQ0FBVyxFQUFFLENBQUMsQ0FBQztRQUU3Qzs7O1dBR0c7UUFDTSxnQkFBVyxHQUFHLE1BQU0sQ0FBZ0IsSUFBSSxDQUFDLENBQUM7UUFFbkQ7OztXQUdHO1FBQ2MsY0FBUyxHQUFHLFlBQVksQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUVyRDs7O1dBR0c7UUFDTSxXQUFNLEdBQUcsTUFBTSxDQUFXLEVBQUUsQ0FBQyxDQUFDO1FBRXZDOzs7V0FHRztRQUNNLGFBQVEsR0FBRyxNQUFNLENBQWlCLElBQUksQ0FBQyxDQUFDO1FBRWpEOzs7V0FHRztRQUNNLFlBQU8sR0FBRyxNQUFNLENBQWlCLElBQUksQ0FBQyxDQUFDO1FBRWhEOzs7V0FHRztRQUNNLFVBQUssR0FBRyxNQUFNLENBQWlCLElBQUksQ0FBQyxDQUFDO1FBRTlDOztXQUVHO1FBQ00sVUFBSyxHQUFHLE1BQU0sQ0FBaUIsSUFBSSxD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TSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEtBQUssS0FBSyxDQUFDLENBQUMsQ0FBQztJQUNoRSxDQUFDO0lBRUQ7Ozs7T0FJRztJQUNILGlCQUFpQixDQUFDLFdBQW1CO1FBQ25DLElBQUksQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxFQUFFLENBQUMsWUFBWSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsS0FBSyxXQUFXLENBQUMsQ0FBQyxDQUFDO0lBQ3hGLENBQUM7K0dBektVLFlBQVk7bUdBQVosWUFBWSxtYUFYWixDQUFDLEVBQUUsT0FBTyxFQUFFLGlCQUFpQixFQUFFLFdBQVcsRUFBRSxZQUFZLEVBQUUsQ0FBQyxpRUFrQzVCLFNBQVM7OzRGQXZCeEMsWUFBWTtrQkFmeEIsU0FBUzttQkFBQztvQkFDVCxVQUFVLEVBQUUsSUFBSTtvQkFDaEIsUUFBUSxFQUFFLGdCQUFnQjtvQkFDMUIsUUFBUSxFQUFFLGNBQWM7b0JBQ3hCLFNBQVMsRUFBRSxDQUFDLEVBQUUsT0FBTyxFQUFFLGlCQUFpQixFQUFFLFdBQVcsY0FBYyxFQUFFLENBQUM7b0JBQ3RFLElBQUksRUFBRTt3QkFDSixxQkFBcUIsRUFBRSx1QkFBdUI7d0JBQzlDLG1CQUFtQixFQUFFLHFCQUFxQjt3QkFDMUMscUJBQXFCLEVBQUUsdUJBQXVCO3dCQUM5QyxzQkFBc0IsRUFBRSx3QkFBd0I7d0JBQ2hELG1CQUFtQixFQUFFLHFCQUFxQjt3QkFDMUMscUJBQXFCLEVBQUUsdUJBQXVCO3dCQUM5QyxzQkFBc0IsRUFBRSx3QkFBd0I7cUJBQ2pEO2lCQUNGIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgwqkgMjAyNCBBbmd1bGFyIFByaW1pdGl2ZXMuXG4gKiBodHRwczovL2dpdGh1Yi5jb20vbmctcHJpbWl0aXZlcy9uZy1wcmltaXRpdmVzXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIDIuMCBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICovXG5pbXBvcnQgeyBEaXJlY3RpdmUsIE9uRGVzdHJveSwgY29udGVudENoaWxkLCBzaWduYWwgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IE5nQ29udHJvbCB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IG9uQ2hhbmdlIH0gZnJvbSAnbmctcHJpbWl0aXZlcy91dGlscyc7XG5pbXBvcnQgeyBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IE5ncEZvcm1GaWVsZFRva2VuIH0gZnJvbSAnLi9mb3JtLWZpZWxkLnRva2VuJztcblxuQERpcmVjdGl2ZSh7XG4gIHN0YW5kYWxvbmU6IHRydWUsXG4gIHNlbGVjdG9yOiAnW25ncEZvcm1GaWVsZF0nLFxuICBleHBvcnRBczogJ25ncEZvcm1GaWVsZCcsXG4gIHByb3ZpZGVyczogW3sgcHJvdmlkZTogTmdwRm9ybUZpZWxkVG9rZW4sIHVzZUV4aXN0aW5nOiBOZ3BGb3JtRmllbGQgfV0sXG4gIGhvc3Q6IHtcbiAgICAnW2F0dHIuZGF0YS1pbnZhbGlkXSc6ICdpbnZhbGlkKCkgPyBcIlwiIDogbnVsbCcsXG4gICAgJ1thdHRyLmRhdGEtdmFsaWRdJzogJ3ZhbGlkKCkgPyBcIlwiIDogbnVsbCcsXG4gICAgJ1thdHRyLmRhdGEtdG91Y2hlZF0nOiAndG91Y2hlZCgpID8gXCJcIiA6IG51bGwnLFxuICAgICdbYXR0ci5kYXRhLXByaXN0aW5lXSc6ICdwcmlzdGluZSgpID8gXCJcIiA6IG51bGwnLFxuICAgICdbYXR0ci5kYXRhLWRpcnR5XSc6ICdkaXJ0eSgpID8gXCJcIiA6IG51bGwnLFxuICAgICdbYXR0ci5kYXRhLXBlbmRpbmddJzogJ3BlbmRpbmcoKSA/IFwiXCIgOiBudWxsJyxcbiAgICAnW2F0dHIuZGF0YS1kaXNhYmxlZF0nOiAnZGlzYWJsZWQoKSA/IFwiXCIgOiBudWxsJyxcbiAgfSxcbn0pXG5leHBvcnQgY2xhc3MgTmdwRm9ybUZpZWxkIGltcGxlbWVudHMgT25EZXN0cm95IHtcbiAgLyoqXG4gICAqIFN0b3JlIHRoZSBmb3JtIGxhYmVsLlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHJlYWRvbmx5IGxhYmVscyA9IHNpZ25hbDxzdHJpbmdbXT4oW10pO1xuXG4gIC8qKlxuICAgKiBTdG9yZSB0aGUgZm9ybSBkZXNjcmlwdGlvbnMuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgcmVhZG9ubHkgZGVzY3JpcHRpb25zID0gc2lnbmFsPHN0cmluZ1tdPihbXSk7XG5cbiAgLyoqXG4gICAqIFN0b3JlIHRoZSBpZCBvZiB0aGUgYXNzb2NpYXRlZCBmb3JtIGNvbnRyb2wuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgcmVhZG9ubHkgZm9ybUNvbnRyb2wgPSBzaWduYWw8c3RyaW5nIHwgbnVsbD4obnVsbCk7XG5cbiAgLyoqXG4gICAqIEZpbmQgYW55IE5nQ29udHJvbCB3aXRoaW4gdGhlIGZvcm0gZmllbGQuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgcHJpdmF0ZSByZWFkb25seSBuZ0NvbnRyb2wgPSBjb250ZW50Q2hpbGQoTmdDb250cm9sKTtcblxuICAvKipcbiAgICogU3RvcmUgdGhlIHZhbGlkYXRpb24gZXJyb3IgbWVzc2FnZXMuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgcmVhZG9ubHkgZXJyb3JzID0gc2lnbmFsPHN0cmluZ1tdPihbXSk7XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgdGhlIGNvbnRyb2wgaXMgcHJpc3RpbmUuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgcmVhZG9ubHkgcHJpc3RpbmUgPSBzaWduYWw8Ym9vbGVhbiB8IG51bGw+KG51bGwpO1xuXG4gIC8qKlxuICAgKiBXaGV0aGVyIHRoZSBjb250cm9sIGlzIHRvdWNoZWQuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgcmVhZG9ubHkgdG91Y2hlZCA9IHNpZ25hbDxib29sZWFuIHwgbnVsbD4obnVsbCk7XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgdGhlIGNvbnRyb2wgaXMgZGlydHkuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgcmVhZG9ubHkgZGlydHkgPSBzaWduYWw8Ym9vbGVhbiB8IG51bGw+KG51bGwpO1xuXG4gIC8qKlxuICAgKiBXaGV0aGVyIHRoZSBjb250cm9sIGlzIHZhbGlkLlxuICAgKi9cbiAgcmVhZG9ubHkgdmFsaWQgPSBzaWduYWw8Ym9vbGVhbiB8IG51bGw+KG51bGwpO1xuXG4gIC8qKlxuICAgKiBXaGV0aGVyIHRoZSBjb250cm9sIGlzIGludmFsaWQuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgcmVhZG9ubHkgaW52YWxpZCA9IHNpZ25hbDxib29sZWFuIHwgbnVsbD4obnVsbCk7XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgdGhlIGNvbnRyb2wgaXMgcGVuZGluZy5cbiAgICogQGludGVybmFsXG4gICAqL1xuICByZWFkb25seSBwZW5kaW5nID0gc2lnbmFsPGJvb2xlYW4gfCBudWxsPihudWxsKTtcblxuICAvKipcbiAgICogV2hldGhlciB0aGUgY29udHJvbCBpcyBkaXNhYmxlZC5cbiAgICogQGludGVybmFsXG4gICAqL1xuICByZWFkb25seSBkaXNhYmxlZCA9IHNpZ25hbDxib29sZWFuIHwgbnVsbD4obnVsbCk7XG5cbiAgLyoqXG4gICAqIFN0b3JlIHRoZSBjdXJyZW50IHN0YXR1cyBzdWJzY3JpcHRpb24uXG4gICAqL1xuICBwcml2YXRlIHN1YnNjcmlwdGlvbj86IFN1YnNjcmlwdGlvbjtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICAvLyBhbnkgdGltZSB0aGUgbmdDb250cm9sIGNoYW5nZXMsIHNldHVwIHRoZSBzdWJzY3JpcHRpb25zLlxuICAgIG9uQ2hhbmdlKHRoaXMubmdDb250cm9sLCB0aGlzLnNldHVwU3Vic2NyaXB0aW9ucy5iaW5kKHRoaXMpKTtcbiAgfVxuXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgIHRoaXMuc3Vic2NyaXB0aW9uPy51bnN1YnNjcmliZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldHVwIGEgbGlzdGVuZXIgZm9yIHRoZSBmb3JtIGNvbnRyb2wgc3RhdHVzLlxuICAgKiBAcGFyYW0gY29udHJvbFxuICAgKi9cbiAgcHJpdmF0ZSBzZXR1cFN1YnNjcmlwdGlvbnMoY29udHJvbDogTmdDb250cm9sIHwgbnVsbCB8IHVuZGVmaW5lZCk6IHZvaWQge1xuICAgIC8vIFVuc3Vic2NyaWJlIGZyb20gdGhlIHByZXZpb3VzIHN1YnNjcmlwdGlvbnMuXG4gICAgdGhpcy5zdWJzY3JpcHRpb24/LnVuc3Vic2NyaWJlKCk7XG5cbiAgICAvLyBzZXQgdGhlIGluaXRpYWwgdmFsdWVzXG4gICAgdGhpcy51cGRhdGVTdGF0dXMoKTtcblxuICAgIC8vIExpc3RlbiBmb3IgY2hhbmdlcyB0byB0aGUgZm9ybSBjb250cm9sLlxuICAgIHRoaXMuc3Vic2NyaXB0aW9uID0gY29udHJvbD8udmFsdWVDaGFuZ2VzPy5zdWJzY3JpYmUodGhpcy51cGRhdGVTdGF0dXMuYmluZCh0aGlzKSk7XG4gIH1cblxuICBwcml2YXRlIHVwZGF0ZVN0YXR1cygpOiB2b2lkIHtcbiAgICBjb25zdCBjb250cm9sID0gdGhpcy5uZ0NvbnRyb2woKTtcblxuICAgIGlmICghY29udHJvbCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMucHJpc3RpbmUuc2V0KGNvbnRyb2wucHJpc3RpbmUpO1xuICAgIHRoaXMudG91Y2hlZC5zZXQoY29udHJvbC50b3VjaGVkKTtcbiAgICB0aGlzLmRpcnR5LnNldChjb250cm9sLmRpcnR5KTtcbiAgICB0aGlzLnZhbGlkLnNldChjb250cm9sLnZhbGlkKTtcbiAgICB0aGlzLmludmFsaWQuc2V0KGNvbnRyb2wuaW52YWxpZCk7XG4gICAgdGhpcy5wZW5kaW5nLnNldChjb250cm9sLnBlbmRpbmcpO1xuICAgIHRoaXMuZGlzYWJsZWQuc2V0KGNvbnRyb2wuZGlzYWJsZWQpO1xuICAgIHRoaXMuZXJyb3JzLnNldChjb250cm9sPy5lcnJvcnMgPyBPYmplY3Qua2V5cyhjb250cm9sLmVycm9ycykgOiBbXSk7XG4gIH1cblxuICAvKipcbiAgICogUmVnaXN0ZXIgdGhlIGlkIG9mIHRoZSBhc3NvY2lhdGVkIGZvcm0gY29udHJvbC5cbiAgICogQHBhcmFtIGlkXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgc2V0Rm9ybUNvbnRyb2woaWQ6IHN0cmluZyk6IHZvaWQge1xuICAgIHRoaXMuZm9ybUNvbnRyb2wuc2V0KGlkKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZWdpc3RlciBhIGxhYmVsIHdpdGggdGhlIGZvcm0gZmllbGQuXG4gICAqIEBwYXJhbSBsYWJlbFxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGFkZExhYmVsKGxhYmVsOiBzdHJpbmcpOiB2b2lkIHtcbiAgICB0aGlzLmxhYmVscy51cGRhdGUobGFiZWxzID0+IFsuLi5sYWJlbHMsIGxhYmVsXSk7XG4gIH1cblxuICAvKipcbiAgICogUmVnaXN0ZXIgYSBkZXNjcmlwdGlvbiB3aXRoIHRoZSBmb3JtIGZpZWxkLlxuICAgKiBAcGFyYW0gZGVzY3JpcHRpb25cbiAgICogQGludGVybmFsXG4gICAqL1xuICBhZGREZXNjcmlwdGlvbihkZXNjcmlwdGlvbjogc3RyaW5nKTogdm9pZCB7XG4gICAgdGhpcy5kZXNjcmlwdGlvbnMudXBkYXRlKGRlc2NyaXB0aW9ucyA9PiBbLi4uZGVzY3JpcHRpb25zLCBkZXNjcmlwdGlvbl0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlbW92ZSB0aGUgYXNzb2NpYXRlZCBmb3JtIGNvbnRyb2wuXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgcmVtb3ZlRm9ybUNvbnRyb2woKTogdm9pZCB7XG4gICAgdGhpcy5mb3JtQ29udHJvbC5zZXQobnVsbCk7XG4gIH1cblxuICAvKipcbiAgICogUmVtb3ZlIGEgbGFiZWwgZnJvbSB0aGUgZm9ybSBmaWVsZC5cbiAgICogQHBhcmFtIGxhYmVsXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgcmVtb3ZlTGFiZWwobGFiZWw6IHN0cmluZyk6IHZvaWQge1xuICAgIHRoaXMubGFiZWxzLnVwZGF0ZShsYWJlbHMgPT4gbGFiZWxzLmZpbHRlcihsID0+IGwgIT09IGxhYmVsKSk7XG4gIH1cblxuICAvKipcbiAgICogUmVtb3ZlIGEgZGVzY3JpcHRpb24gZnJvbSB0aGUgZm9ybSBmaWVsZC5cbiAgICogQHBhcmFtIGRlc2NyaXB0aW9uXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgcmVtb3ZlRGVzY3JpcHRpb24oZGVzY3JpcHRpb246IHN0cmluZyk6IHZvaWQge1xuICAgIHRoaXMuZGVzY3JpcHRpb25zLnVwZGF0ZShkZXNjcmlwdGlvbnMgPT4gZGVzY3JpcHRpb25zLmZpbHRlcihkID0+IGQgIT09IGRlc2NyaXB0aW9uKSk7XG4gIH1cbn1cbiJdfQ==